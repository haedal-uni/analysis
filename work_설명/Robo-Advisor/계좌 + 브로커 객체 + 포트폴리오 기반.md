# ë¡œë³´ì–´ë“œë°”ì´ì €

---

## ë¡œë³´ì–´ë“œë°”ì´ì €(Robo-Advisor)ë€?

ë¡œë³´ì–´ë“œë°”ì´ì €ëŠ” **ì‚¬ëŒì˜ ê°œì… ì—†ì´ ìë™ìœ¼ë¡œ íˆ¬ì ì „ëµì„ ì‹¤í–‰í•˜ëŠ” í”„ë¡œê·¸ë¨**ì´ë‹¤. 

ì£¼ë¡œ ì•„ë˜ì™€ ê°™ì€ ì—­í• ì„ í•œë‹¤.

- ì‹œì„¸ ë°ì´í„°ë¥¼ ë¶„ì„í•´ì„œ               
- ì •í•´ì§„ ê·œì¹™(ì „ëµ)ì— ë”°ë¼ ë§¤ìˆ˜/ë§¤ë„ íŒë‹¨ì„ í•˜ê³            
- í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ìë™ìœ¼ë¡œ ì¡°ì •í•˜ë©°
- ìµœì¢… ì„±ê³¼ë¥¼ ê³„ì‚°í•˜ê³  ì‹œê°í™”í•¨

ì´ê²ƒì„ ì½”ë“œë¡œ êµ¬í˜„í•˜ë©´ ì£¼ì‹ ë˜ëŠ” ìì‚°ì˜ ë°±í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ìë™ë§¤ë§¤ ì‹œìŠ¤í…œì²˜ëŸ¼ ì‘ë™í•œë‹¤.  


---

## ì „ì²´ ì½”ë“œ íë¦„ (ì‹œë®¬ë ˆì´ì…˜ ê³¼ì •)

```
    A[CSV íŒŒì¼ë¡œ ì‹œì„¸ ë°ì´í„° ë¡œë“œ] --> B[ì´ë™í‰ê·  ê³„ì‚° (SMA, EMA)]
    B --> C[ë§¤ìˆ˜/ë§¤ë„ ë¹„ì¤‘ ê²°ì • (ì „ëµ)]
    C --> D[ë¸Œë¡œì»¤ê°€ ì£¼ë¬¸ ì²˜ë¦¬]
    D --> E[ê³„ì¢Œì— ë°˜ì˜ â†’ í˜„ê¸ˆ & ë³´ìœ ìì‚° ì—…ë°ì´íŠ¸]
    E --> F[ë‚ ì§œë³„ í¬íŠ¸í´ë¦¬ì˜¤ ìì‚° ê°€ì¹˜ ì €ì¥]
    F --> G[ì„±ê³¼ ë¶„ì„ ë° ì‹œê°í™” (ìˆ˜ìµë¥ , MDD, ìƒ¤í”„ì§€ìˆ˜ ë“±)]
```


---

## êµ¬ì„± ìš”ì†Œë³„ ì„¤ëª…

### 1. ë°ì´í„° ë¡œë”©
- CSVë¡œ ì €ì¥ëœ ì¢…ëª©ì˜ ì‹œì„¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¨ë‹¤.
- ë°ì´í„°ì—ëŠ” ì‹œê°€(Open), ì¢…ê°€(Close), ê³ ê°€(High), ì €ê°€(Low), ê±°ë˜ëŸ‰(Volume), ë³€ë™ë¥ (Change%) ë“±ì´ í¬í•¨ë˜ì–´ ìˆë‹¤.
- ìˆ˜ëŸ‰ì€ ì—†ì–´ë„ ê´œì°®ë‹¤. ìš°ë¦¬ëŠ” **ë¹„ì¤‘(percent)** ê¸°ë°˜ìœ¼ë¡œ ë§¤ë§¤ ì „ëµì„ ì‹¤í–‰í•˜ê¸° ë•Œë¬¸ì´ë‹¤.


### 2. ì´ë™í‰ê· ì„  ê³„ì‚°
**ì´ë™í‰ê· ì„ (Moving Average)** : ì¼ì • ê¸°ê°„ ë™ì•ˆì˜ í‰ê·  ê°€ê²©ìœ¼ë¡œ ì¶”ì„¸ë¥¼ íŒŒì•…í•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤.

#### ğŸ”¹ SMA (Simple Moving Average)
- ì¼ì • ê¸°ê°„ì˜ **ë‹¨ìˆœ í‰ê· ê°’**
- ì˜ˆ: 5ì¼ SMA = (ì˜¤ëŠ˜ ì¢…ê°€ + ì–´ì œ ì¢…ê°€ + ... + 5ì¼ ì „ ì¢…ê°€) / 5
- ê°‘ì‘ìŠ¤ëŸ° ë³€ë™ì— ë¯¼ê°í•˜ì§€ ì•Šì•„ ì „ì²´ íë¦„ì„ ë³¼ ë•Œ ìœ ìš©

#### ğŸ”¹ EMA (Exponential Moving Average)
- ìµœê·¼ ë°ì´í„°ì— **ê°€ì¤‘ì¹˜ë¥¼ ë” ë§ì´ ì£¼ëŠ” í‰ê· **
- ìµœê·¼ ê°€ê²© ë³€ë™ì„ ë” ë¹ ë¥´ê²Œ ë°˜ì˜í•¨
- ë” ë¯¼ê°í•œ ì „ëµì„ ë§Œë“¤ ë•Œ ìœ ìš©


### 3. ì „ëµ êµ¬í˜„
- SMAë‚˜ EMAë¥¼ í™œìš©í•´ì„œ ë§¤ìˆ˜/ë§¤ë„ íƒ€ì´ë°ì„ ê²°ì •í•œë‹¤.
- ì˜ˆì‹œ ì „ëµ: "ë‹¨ê¸° SMA > ì¥ê¸° SMA"ë©´ ë§¤ìˆ˜, ì•„ë‹ˆë©´ ë§¤ë„

```py
if short_sma > long_sma:
    weight = 1.0  # ì „ëŸ‰ ë§¤ìˆ˜
else:
    weight = 0.0  # ì „ëŸ‰ ë§¤ë„
```


### 4. ë¸Œë¡œì»¤ì™€ ê³„ì¢Œ
- **Broker**: ì „ëµì—ì„œ ë‚˜ì˜¨ ë¹„ì¤‘(weight)ì„ ë°”íƒ•ìœ¼ë¡œ ìì‚°ì„ ë§¤ë§¤í•˜ëŠ” ì—­í• 
- **Account**: í˜„ì¬ ê°€ì§„ í˜„ê¸ˆ, ìì‚°ì˜ ìˆ˜ëŸ‰, ìì‚°ê°€ì¹˜ ë“±ì„ ê³„ì‚°í•˜ê³  ê¸°ë¡
- ì‹¤ì œ ìˆ˜ëŸ‰ì´ ì—†ì–´ë„ ë¹„ì¤‘ê³¼ ê°€ê²©ìœ¼ë¡œ ìˆ˜ëŸ‰ì„ ê°€ì •í•´ ê³„ì‚° ê°€ëŠ¥


### 5. í¬íŠ¸í´ë¦¬ì˜¤ ìì‚°ê°€ì¹˜ ê¸°ë¡
- ë‚ ì§œë³„ ìì‚° ê°€ì¹˜(í˜„ê¸ˆ + ì£¼ì‹ê°€ì¹˜)ë¥¼ ê¸°ë¡í•œë‹¤
- ì´ ë°ì´í„°ëŠ” ë‚˜ì¤‘ì— ìˆ˜ìµë¥ ê³¼ ìœ„í—˜ì„ ê³„ì‚°í•˜ëŠ” ë° ì‚¬ìš©ëœë‹¤.


### 6. ì„±ê³¼ ì§€í‘œ ë¶„ì„
- **ëˆ„ì  ìˆ˜ìµë¥ **: ì²˜ìŒ ëŒ€ë¹„ ëª‡ % ìˆ˜ìµì´ ë‚¬ëŠ”ì§€
- **MDD (Maximum Drawdown)**: ìµœëŒ€ ë‚™í­ (ì–¼ë§ˆë‚˜ ë–¨ì–´ì¡ŒëŠ”ê°€)
- **Sharpe Ratio**: ìœ„í—˜ ëŒ€ë¹„ ìˆ˜ìµë¥  â†’ ë†’ì„ìˆ˜ë¡ ìš°ìˆ˜í•œ ì „ëµ

```py
# ëˆ„ì  ìˆ˜ìµë¥  ê³„ì‚°
cumulative_return = portfolio_value / initial_value - 1
```


---

## ìš©ì–´ ì •ë¦¬ ë° ê´€ë ¨ ì„¤ëª…

| ìš©ì–´ | ì„¤ëª… |
|------|------|
| SMA (ë‹¨ìˆœ ì´ë™í‰ê· ) | ì¼ì • ê¸°ê°„ ë™ì•ˆì˜ ì¢…ê°€ í‰ê· . ì¶”ì„¸ íŒŒì•…ìš© |
| EMA (ì§€ìˆ˜ ì´ë™í‰ê· ) | ìµœê·¼ ë°ì´í„°ì— ë” í° ë¹„ì¤‘ì„ ë‘ëŠ” í‰ê· . ë¹ ë¥¸ ë°˜ì‘ |
| Weight (ë¹„ì¤‘) | ì „ì²´ ìì‚° ì¤‘ í•´ë‹¹ ì¢…ëª©ì— íˆ¬ìí•  ë¹„ìœ¨. 0.5ë©´ ì ˆë°˜ íˆ¬ì |
| MDD (ìµœëŒ€ ë‚™í­) | ì „ëµ ì‹¤í–‰ ì¤‘ ìì‚°ì´ ì–¼ë§ˆë‚˜ ë–¨ì–´ì¡ŒëŠ”ì§€ì˜ ìµœëŒ€ê°’ |
| Sharpe Ratio | ìˆ˜ìµì˜ ì•ˆì •ì„±ì„ ë‚˜íƒ€ëƒ„. ë†’ì„ìˆ˜ë¡ ìœ„í—˜ ëŒ€ë¹„ ìˆ˜ìµì´ ì¢‹ìŒ |
| ë°±í…ŒìŠ¤íŠ¸ | ê³¼ê±° ë°ì´í„°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì „ëµì„ ì‹¤í–‰í•´ ì„±ê³¼ë¥¼ ê²€ì¦í•˜ëŠ” ê³¼ì • |


---

## ë¡œë³´ì–´ë“œë°”ì´ì € êµ¬í˜„ì˜ íŠ¹ì§•

- ì‚¬ëŒ ì—†ì´ ìë™ìœ¼ë¡œ ì „ëµì´ ìˆ˜í–‰ë¨
- SMA/EMA ê¸°ë°˜ ë‹¨ìˆœ ì „ëµë„ íš¨ê³¼ í™•ì¸ ê°€ëŠ¥
- ìˆ˜ëŸ‰ ë°ì´í„° ì—†ì´ë„ "ë¹„ì¤‘"ìœ¼ë¡œ íˆ¬ì ì‹œë®¬ë ˆì´ì…˜ ê°€ëŠ¥
- Broker/Account êµ¬ì¡°ë¡œ ì‹¤ì œ ë§¤ë§¤ì²˜ëŸ¼ ì„¤ê³„í•  ìˆ˜ ìˆìŒ
- í¬íŠ¸í´ë¦¬ì˜¤ ì„±ê³¼ë¥¼ ì‹œê°í™”í•˜ì—¬ ë¹„êµ ê°€ëŠ¥


---

## ìš”ì•½

> "ë¡œë³´ì–´ë“œë°”ì´ì €ëŠ” ê³¼ê±° ë°ì´í„°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìë™ìœ¼ë¡œ íˆ¬ìì „ëµì„ ìˆ˜í–‰í•˜ê³       
> í¬íŠ¸í´ë¦¬ì˜¤ì˜ ë³€í™”ë¥¼ ì¶”ì í•˜ë©° ìˆ˜ìµë¥ ê³¼ ë¦¬ìŠ¤í¬ë¥¼ ë¶„ì„í•˜ëŠ” ì‹œìŠ¤í…œì´ë‹¤.        
> ì‹œê°€/ì¢…ê°€ ì •ë³´ë§Œìœ¼ë¡œë„ ê°€ëŠ¥í•˜ë©° SMAì™€ EMAë¥¼ í™œìš©í•´ ê°„ë‹¨í•œ ì „ëµë„ ì‰½ê²Œ ë§Œë“¤ ìˆ˜ ìˆë‹¤."          


---

í•„ìš” ì‹œ:
- ì „ëµ ë‹¤ì–‘í™”: RSI, MACD, ëª¨ë©˜í…€ ë“± ì¶”ê°€ ê°€ëŠ¥
- ë‹¤ì¤‘ ì¢…ëª© í™•ì¥: í¬íŠ¸í´ë¦¬ì˜¤ ì „ëµìœ¼ë¡œ ë°œì „ ê°€ëŠ¥
- ê°•í™”í•™ìŠµ ê¸°ë°˜ ë¡œë³´ì–´ë“œë°”ì´ì € êµ¬í˜„ë„ ê°€ëŠ¥í•¨ (ì‹¬í™”ë‹¨ê³„)

<br><br>

---

<br><br>

## ì „ëµ ë°±í…ŒìŠ¤íŠ¸ ì½”ë“œ í•´ì„

### 1. í•„ìš”í•œ ë„êµ¬ ë¶ˆëŸ¬ì˜¤ê¸°
```python
import pandas as pd
import numpy as np
import plotly.express as px
from typing import Optional, Dict
```
- `pandas`: í‘œ(ì—‘ì…€ì²˜ëŸ¼ ìƒê¸´ ë°ì´í„°)ë¥¼ ì‰½ê²Œ ë‹¤ë£¨ê²Œ í•´ì¤€ë‹¤.
- `numpy`: ìˆ«ì ê³„ì‚°ì„ ë¹¨ë¦¬ í•´ì¤€ë‹¤.
- `plotly`: ê·¸ë˜í”„ë¥¼ ì˜ˆì˜ê²Œ ê·¸ë ¤ì¤€ë‹¤.
- `typing`: ë³€ìˆ˜ì— ì–´ë–¤ ìë£Œê°€ ë“¤ì–´ì˜¬ì§€ ì•Œë ¤ì¤€ë‹¤.

---

### 2. Account í´ë˜ìŠ¤: ë‚´ ëˆì„ ê´€ë¦¬í•˜ëŠ” ì§€ê°‘
```python
class Account:
    def __init__(self, initial_cash):
        self.cash = initial_cash
        self.holdings = {}
        self.orders = []
        self.portfolio_history = []
```
- `self.cash`: ì§€ê¸ˆ ë‚´ ì§€ê°‘ì— ìˆëŠ” ëˆ
- `self.holdings`: ì–´ë–¤ ì£¼ì‹ì„ ëª‡ ê°œ ìƒ€ëŠ”ì§€ ê¸°ë¡í•œë‹¤.
- `self.orders`: ë‚´ê°€ ì‚¬ê³  ì‹¶ì€ ì£¼ì‹ ëª©ë¡ì´ë‹¤.
- `self.portfolio_history`: ë‚ ì§œë³„ë¡œ ë‚´ ìì‚° ë³€í™”ë¥¼ ê¸°ë¡í•œë‹¤.

#### ì£¼ì‹ ì‚° ê±¸ ë°˜ì˜
```python
    def update_position(self, transactions):
        for trans in transactions:
            ticker = trans['ticker']
            price = trans['price']
            quantity = trans['quantity']
            cost = price * quantity
            self.cash -= cost
            self.holdings[ticker] = self.holdings.get(ticker, 0) + quantity
```
- ì‹¤ì œë¡œ ì‚° ì£¼ì‹ ì •ë³´ë¥¼ ë³´ê³  í˜„ê¸ˆì„ ë¹¼ê³  ì£¼ì‹ ìˆ˜ëŸ‰ì„ ë”í•œë‹¤.

#### ìì‚°ì„ ê³„ì‚° 
```python
    def update_portfolio(self, dt, data):
        value = self.cash
        for _, row in data.iterrows():
            ticker = row['ticker']
            price = row['close']
            quantity = self.holdings.get(ticker, 0)
            value += price * quantity
        self.portfolio_history.append({'date': dt, 'value': value})
```
- í˜„ì¬ ê°€ì§„ í˜„ê¸ˆ + ì£¼ì‹ ê°€ì¹˜ë¥¼ ëª¨ë‘ ë”í•´ì„œ ì „ì²´ ìì‚°ì„ ê¸°ë¡í•œë‹¤. 

#### ì£¼ë¬¸ ë‚´ì—­ ë¹„ìš°ê¸°
```python
    def update_order(self):
        self.orders = []
```
- ì£¼ë¬¸ ë‹¤ ì²˜ë¦¬í–ˆìœ¼ë‹ˆ ì£¼ë¬¸ ëª©ë¡ì„ ê¹¨ë—í•˜ê²Œ ë¹„ìš´ë‹¤.

---

### Broker í´ë˜ìŠ¤: ì£¼ë¬¸ì„ ì²˜ë¦¬í•´ì£¼ëŠ” ì‚¬ëŒ
```python
class Broker:
    def process_order(self, dt, data, orders):
        results = []
        for order in orders:
            ticker = order['ticker']
            weight = order['weight']
            close_price = data.loc[data['ticker'] == ticker, 'close'].values
            if len(close_price) == 0:
                continue
            price = close_price[0]
            total_value = order['total_value']
            quantity = int(total_value // price)
            if quantity <= 0:
                continue
            results.append({
                'ticker': ticker,
                'price': price,
                'quantity': quantity
            })
        return results
```
- ì¢…ê°€(`close`)ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì£¼ë¬¸ì„ ì²˜ë¦¬í•œë‹¤.
- ëˆìœ¼ë¡œ ëª‡ ê°œ ì‚´ ìˆ˜ ìˆëŠ”ì§€ ê³„ì‚°í•´ì„œ ê²°ê³¼ë¥¼ ì•Œë ¤ì¤€ë‹¤.

---

### ë¦¬ë°¸ëŸ°ì‹±: ìì‚°ì„ ë‹¤ì‹œ ë‚˜ëˆ ìš”
```python
def rebalance(dt, data, account, weights):
    total_value = account.cash
    for ticker, weight in weights.items():
        invest_amount = total_value * weight
        account.orders.append({
            'ticker': ticker,
            'weight': weight,
            'total_value': invest_amount
        })
```
- ê°€ì§„ ëˆì„ ë¹„ìœ¨ëŒ€ë¡œ ë‚˜ëˆ„ì–´ì„œ ê° ì£¼ì‹ì— íˆ¬ìí•  ê¸ˆì•¡ì„ ê³„ì‚°í•œë‹¤.

---

### ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ë° ì •ë¦¬í•˜ê¸°
```python
df1 = pd.read_csv('ë¯¸êµ­ ì² ê°• ì½”ì¼ ì„ ë¬¼ ê³¼ê±° ë°ì´í„°.csv', parse_dates=['ë‚ ì§œ'], thousands=",")
df2 = pd.read_csv('êµ¬ë¦¬ ì„ ë¬¼ ê³¼ê±° ë°ì´í„°.csv', parse_dates=['ë‚ ì§œ'], thousands=",")
df1['ticker'] = 'STEEL'
df2['ticker'] = 'COPPER'
df = pd.concat([df1, df2], ignore_index=True)

df['ê±°ë˜ëŸ‰'] = df['ê±°ë˜ëŸ‰'].apply(lambda x: float(str(x).replace('K', '')) * 1000 if 'K' in str(x) else float(x))
df['ë³€ë™ %'] = df['ë³€ë™ %'].apply(lambda x: float(str(x).replace('%', '')) / 100)
df.sort_values('ë‚ ì§œ', inplace=True)
df.dropna(inplace=True)
df.rename(columns={'ë‚ ì§œ': 'date', 'ì¢…ê°€': 'close'}, inplace=True)
```
- CSV íŒŒì¼ë¡œ ì£¼ì‹ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ê³  ë‚ ì§œ í˜•ì‹ìœ¼ë¡œ ë°”ê¾¸ê³  ì •ë¦¬í•œë‹¤.

---

### ì´ë™ í‰ê· (MA) ê³„ì‚° í•¨ìˆ˜
```python
def calculate_MA(ohlcv_data: pd.DataFrame, period: int, ma_type: str) -> pd.DataFrame:
    close_data = ohlcv_data[['date', 'ticker', 'close']].copy()
    close_data = close_data.set_index(['date', 'ticker']).unstack(level=1)['close']
    if ma_type == 'sma':
        ma = close_data.rolling(window=period).mean()
    elif ma_type == 'ema':
        ma = close_data.ewm(span=period).mean()
    else:
        raise ValueError("Invalid MA type")
    return ma
```
- SMA: ë‹¨ìˆœ í‰ê·  (simple)  
- EMA: ìµœê·¼ ë°ì´í„°ì— ê°€ì¤‘ì¹˜ë¥¼ ì¤€ í‰ê·  (exponential)

---

### MA ê¸°ë°˜ íˆ¬ì ë¹„ìœ¨ ê³„ì‚°
```python
def get_moving_average_weights(ohlcv_data: pd.DataFrame, ma_data: pd.Series) -> Optional[Dict]:
    if ma_data.isnull().any():
        return None
    portfolio = {}
    stocks_to_buy = []
    for ticker in ohlcv_data['ticker'].unique():
        price = ohlcv_data.loc[ohlcv_data['ticker'] == ticker, 'close'].values[0]
        ma_price = ma_data.get(ticker)
        if ma_price is None:
            continue
        if price > ma_price:
            stocks_to_buy.append(ticker)
        else:
            portfolio[ticker] = 0.0
    if not stocks_to_buy:
        return portfolio
    weight = 1 / len(stocks_to_buy)
    for ticker in stocks_to_buy:
        portfolio[ticker] = weight
    return portfolio
```
- ì£¼ì‹ì˜ í˜„ì¬ ê°€ê²©ì´ MAë³´ë‹¤ ë†’ìœ¼ë©´ "ì‚¬ì•¼í•œë‹¤"ë¼ê³  íŒë‹¨í•œë‹¤.

---

### ì „ëµ ì‹¤í–‰ í•¨ìˆ˜
```python
def simulate_moving_average(ohlcv_data: pd.DataFrame, ma_type: str, period: int, label: str) -> pd.DataFrame:
    account = Account(initial_cash=100000000)
    broker = Broker()
    ma = calculate_MA(ohlcv_data, period, ma_type)
    for date, group in ohlcv_data.groupby('date'):
        ohlcv = group
        if date not in ma.index:
            continue
        ma_slice = ma.loc[date]
        weights = get_moving_average_weights(ohlcv, ma_slice)
        if weights is None:
            continue
        rebalance(date, ohlcv, account, weights)
        transactions = broker.process_order(date, ohlcv, account.orders)
        account.update_position(transactions)
        account.update_portfolio(date, ohlcv)
        account.update_order()
    df_result = pd.DataFrame(account.portfolio_history)
    df_result['strategy'] = label
    return df_result
```

---

### ì „ëµ ì‹¤í–‰
```python
sma_result = simulate_moving_average(df, 'sma', period=3, label='SMA')
ema_result = simulate_moving_average(df, 'ema', period=3, label='EMA')
result_df = pd.concat([sma_result, ema_result], ignore_index=True)
```
- SMA ì „ëµê³¼ EMA ì „ëµì„ ëŒë ¤ì„œ ê²°ê³¼ë¥¼ ë¹„êµí•œë‹¤.

---

### ì„±ê³¼ ì§€í‘œ ê³„ì‚°
(ëˆ„ì  ìˆ˜ìµë¥ , ì—°ê°„ ìˆ˜ìµë¥ , MDD, Sharpe ë“± ê³„ì‚°)

```python
def calculate_metrics(df: pd.DataFrame) -> pd.DataFrame:
    df = df.copy()
    df['date'] = pd.to_datetime(df['date'])
    df.sort_values(['strategy', 'date'], inplace=True)
    
    # ëˆ„ì  ìˆ˜ìµë¥ 
    df['cum_return'] = df.groupby('strategy')['value'].transform(lambda x: x / x.iloc[0] - 1)

    # ì¼ê°„ ìˆ˜ìµë¥ 
    df['daily_return'] = df.groupby('strategy')['value'].pct_change()

    # ì—°ê°„ ìˆ˜ìµë¥ 
    df['year'] = df['date'].dt.year
    annual_return = df.groupby(['strategy', 'year']).apply(lambda x: x['value'].iloc[-1] / x['value'].iloc[0] - 1).reset_index()
    annual_return.columns = ['strategy', 'year', 'annual_return']

    # ìµœëŒ€ ë‚™í­ (MDD)
    def calc_mdd(x):
        cumulative = x / x.iloc[0]
        peak = cumulative.cummax()
        drawdown = cumulative / peak - 1
        return drawdown.min()

    mdd_df = df.groupby('strategy')['value'].apply(calc_mdd).reset_index()
    mdd_df.columns = ['strategy', 'MDD']

    # ìƒ¤í”„ì§€ìˆ˜ (ë¬´ìœ„í—˜ìˆ˜ìµë¥  0%)
    sharpe_df = df.groupby('strategy')['daily_return'].agg(['mean', 'std']).reset_index()
    sharpe_df['sharpe'] = sharpe_df['mean'] / sharpe_df['std'] * np.sqrt(252)
    sharpe_df = sharpe_df[['strategy', 'sharpe']]

    # ê²°ê³¼ ë³‘í•©
    summary = pd.merge(mdd_df, sharpe_df, on='strategy')
    return df, annual_return, summary
```

---

### ì‹œê°í™” ë° ì¶œë ¥
```python
fig = px.line(result_df, x='date', y='cum_return', color='strategy', title='ì „ëµë³„ ëˆ„ì  ìˆ˜ìµë¥ ')
fig.show()

fig2 = px.bar(annual_return_df, x='year', y='annual_return', color='strategy', barmode='group', title='ì—°ê°„ ìˆ˜ìµë¥ ')
fig2.show()

print(summary_df.round(4))
```
- ì „ëµë§ˆë‹¤ ìˆ˜ìµë¥ ì´ ì–´ë–»ê²Œ ë³€í–ˆëŠ”ì§€ ê·¸ë¦¼ìœ¼ë¡œ ë³´ì—¬ì¤€ë‹¤.

---


